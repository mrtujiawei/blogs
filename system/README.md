# System #

## 启动 ##

1. bios 自检，硬件初始化  
2. 启动引导管理器(grub)引导阶段  
  * 加载和运行系统启动引导管理器  
3. 内核与镜像文件系统加载  
  * 根据启动引导管理器的预设或临时配置加载内核、镜像文件系统  
  * 加载基本的设备渠道，识别和自动挂载根文件系统  
4. 系统初始化以及服务的加载
  * 启动 `init` 或 `system` (不同系统不一样)  
  * 执行系统初始化脚本  
  * 进入指定的运行级别  
  * 启动相关服务  
  * 开启终端  

### bios 自检阶段 ###

硬件启动和初始化阶段

#### bios ####

位于系统COMS ROM(只读存储器)内的微型操作系统  
COMS 是一种类型的EPROM(可擦除编程只读存储器)  

基本作用:
  * 代码分为两个部分
    1. POST
    2. Run Time
  * POST(Power On Self Test)已经环境基本检查
  * Run Time 基本操作系统启动
  * 键盘，视频设备，串行口初始化，核心设备驱动分配资源
  * 选择合适的引导设备
  * 将第一块(512字节)装入内存并传递引导权到该区域

UEFI(Unified Extensible Firmware Interface,可扩展固件接口)
  * 现代计算机主板上都集成了UEFI固件
  * 更好支持GPT以及2TB以上硬盘
  * 更快启动，更多扩展

### 启动引导 ###

* GRUB Stage1, Start.S, Stage1_5, Stage2  
* grub.conf/grub2.cnf, /etc/default/grub  
* grub配置,内核位置声明,ramdist位置声明，根文件系统位置声明，启动内核选项
* grub shell
* grub 重装
* grub grub2

#### MBR ####

磁盘0磁道0柱面1扇区的前446字节，
前64位为分区表，2字节签名信息，
头446字节通常用于装载系统引导程序的部分代码，并执行

Stage1:
  * GRUB源码的Stage1.S汇编生成，默认安装到磁盘MBR的前446字节内
  * BIOS自检完成后将 stage1载入执行，标志该阶段开始
  * 作用: 状态0磁道0柱面2扇区到内存中执行
  * ...

### 内核与镜像文件系统加载 ###

grub.conf/grub2.cfg

必须的配置信息

1. 启动分区  
2. 内核文件名称和位置，根分区位置，根分区挂载方式以及其他启动方式  
3. 镜像文件系统名称和文职

### 系统初始化以及服务的加载 ###

* 1号进程，运行级别，配置文件
* `runlevel`, `chkconfig`, `systemctl`, `journalctl`

### GRUB 命令 ###

1. `root` 指定根分区
2. `kernel` 指定启动镜像
3. `initrd` 指定启动脚本
4. `boot` 启动


## 进程 ##

### 进程相关概念 ###

程序: 编译好的二进制文件，不占用系统资源（cpu,内存，打开的文件，设备，锁。。。）  
进程：抽象概念，活跃的程序，占用系统资源。在内存中执行。（程序运行起来，产生一个进程）  

### 并发 ###

操作系统中，一个时间段中有多个进程都处于已启动运行到运行完毕之间的状态。任一时刻点只有一个进程在运行。

### 单道程序设计 ###

cpu在同一时刻只能处理一个程序

### 多道程序设计 ###

cpu分片,并行运行

### cpu/mmu ###

cpu: 中央处理器  
mmu: 内存管理单元,位于cpu内部。用于虚拟内存和物理内存的对应，设置修改内存访问级别  
虚拟地址: 可用的地址空间有 4G ，实际没有这么多  

### 进程控制块 ###

进程控制块: PCB


### 进程状态 ###

## 环境变量 ##

### 常用环境变量 ###

### 函数 ###

## 进程控制原语 ##

### fork ###

循环创建子进程的架构

### exec函数簇 ###

各个函数的参数使用方法和作用

### wait/waitpid ###

回收子进程的一般方式

## 进程通信 ##

pipe: 管道一般读写行为  
fifo: 有名管道，用于非血缘关系进程间通信  
共享内存: mmap函数  

### 守护进程  ###

1. 创建子进程，父进程退出。所有工作在子进程中进行形式上脱离了终端控制。  
2. 在子进程中创建新的会话，使子进程完全独立出来，脱离控制。  
3. 改变当前牡蛎未根目录，防止占用可卸载的文件系统。  
4. 重设文件选线掩码，防止继承的文件创建屏蔽字拒绝某些权限。增加守护进程灵活性。  
5. 关闭文件描述符，继承的打开文件不会用到，浪费系统资源，无法卸载。  
6. 开始守护进程核心工作。
7. 守护进程退出处理程序模型。  

## 线程 ##

Light weight process,轻量级的进程，本质仍是进程(linux)。 
操作系统分配时间片的时候是按线程数分配的。

### 线程与进程的关系 ###

| 进程                   | 线程                 |
| -                      | -                    |
| 独立地址空间，拥有 PCB | 有独立地址空间,有PCK |
| 独占地址空间           | 共享地址空间         |
| 最小分配资源单位       | 最小的执行单位       |

### 线程之间共享、非共享 ###

<!-- 其实这里不适合用表格,但是我喜欢 -->

| 非共享                     | 共享               |
| -                          | -                  |
| 线程ID                     | 文件描述符         |
| 处理器现场和栈指针         | 每种信号的处理方式 |
| 独立的栈空间（用户空间栈） | 当前工作目录       |
| errno变量                  | 用户ID和组ID       |
| 信号屏蔽字，调度优先级     | 内存地址空间       |

### 优缺点 ###

优点:  
1. 提高并发性  
2. 开销小  
3. 数据通信、共享数据方便  

缺点:  
1. 库函数,不稳定  
2. 调试、编写困难  
3. 对信号支持不好  

### 线程控制原语 ###

`pthread_self`
1. `create`  
2. `exit`   
3. `join`  

## TCP/IP ##

面向连接的可靠传输协议

## Completely Fair Scheduler

> 完全公平调度器，用于Linux系统中普通进程的调度。
